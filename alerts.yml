# groups:
#   - name: anomaly_alerts
#     rules:
#       - alert: HighLatency
#         expr: avg(rate(http_server_requests_seconds_sum{uri!~"/actuator.*"}[5m])/rate(http_server_requests_seconds_count{uri!~"/actuator.*"}[5m]))*1000 > 100
#         for: 2m
#         labels:
#           severity: warning
#         annotations:
#           summary: "High latency detected"
#           description: "Average latency {{ $value }} ms exceeds 100 ms for 2 minutes."
#       - alert: HighErrorRate
#         expr: rate(http_server_requests_seconds_count{status=~"5.."}[5m])/rate(http_server_requests_seconds_count[5m])*100 > 5
#         for: 2m
#         labels:
#           severity: warning
#         annotations:
#           summary: "High error rate detected"
#           description: "Error rate {{ $value }}% exceeds 5% for 2 minutes."
#       - alert: HighQueueLength
#         expr: sum(executor_queued_tasks{name="applicationTaskExecutor"}) > 50
#         for: 2m
#         labels:
#           severity: warning
#         annotations:
#           summary: "High queue length detected"
#           description: "Queue length {{ $value }} exceeds 50 for 2 minutes."
groups:
  - name: api-alerts
    interval: 5s
    rules:
      - alert: HighLatency_Process
        expr: avg(rate(http_server_requests_seconds_sum{uri="/api/process", application="autonomous-api-optimizer"}[5m]) / rate(http_server_requests_seconds_count{uri="/api/process", application="autonomous-api-optimizer"}[5m])) * 1000 > 30
        for: 10s
        labels:
          severity: warning
          endpoint: process
        annotations:
          summary: High latency detected on /api/process
          description: Average latency for /api/process exceeds 30ms for 10 seconds
      - alert: HighErrorRate_Process
        expr: rate(http_server_requests_seconds_count{uri="/api/process", status=~"5..", application="autonomous-api-optimizer"}[5m]) / rate(http_server_requests_seconds_count{uri="/api/process", application="autonomous-api-optimizer"}[5m]) > 0.005
        for: 10s
        labels:
          severity: critical
          endpoint: process
        annotations:
          summary: High error rate on /api/process
          description: Error rate for /api/process exceeds 0.5% for 10 seconds
      - alert: HighLatency_Update
        expr: avg(rate(http_server_requests_seconds_sum{uri="/api/update", application="autonomous-api-optimizer"}[5m]) / rate(http_server_requests_seconds_count{uri="/api/update", application="autonomous-api-optimizer"}[5m])) * 1000 > 30
        for: 10s
        labels:
          severity: warning
          endpoint: update
        annotations:
          summary: High latency detected on /api/update
          description: Average latency for /api/update exceeds 30ms for 10 seconds
      - alert: HighErrorRate_Update
        expr: rate(http_server_requests_seconds_count{uri="/api/update", status=~"5..", application="autonomous-api-optimizer"}[5m]) / rate(http_server_requests_seconds_count{uri="/api/update", application="autonomous-api-optimizer"}[5m]) > 0.005
        for: 10s
        labels:
          severity: critical
          endpoint: update
        annotations:
          summary: High error rate on /api/update
          description: Error rate for /api/update exceeds 0.5% for 10 seconds
      - alert: HighLatency_Hello
        expr: avg(rate(http_server_requests_seconds_sum{uri="/api/hello", application="autonomous-api-optimizer"}[5m]) / rate(http_server_requests_seconds_count{uri="/api/hello", application="autonomous-api-optimizer"}[5m])) * 1000 > 30
        for: 10s
        labels:
          severity: warning
          endpoint: hello
        annotations:
          summary: High latency detected on /api/hello
          description: Average latency for /api/hello exceeds 30ms for 10 seconds
      - alert: HighErrorRate_Hello
        expr: rate(http_server_requests_seconds_count{uri="/api/hello", status=~"5..", application="autonomous-api-optimizer"}[5m]) / rate(http_server_requests_seconds_count{uri="/api/hello", application="autonomous-api-optimizer"}[5m]) > 0.005
        for: 10s
        labels:
          severity: critical
          endpoint: hello
        annotations:
          summary: High error rate on /api/hello
          description: Error rate for /api/hello exceeds 0.5% for 10 seconds