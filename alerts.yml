# groups:
#   - name: anomaly_alerts
#     rules:
#       - alert: HighLatency
#         expr: avg(rate(http_server_requests_seconds_sum{uri!~"/actuator.*"}[5m])/rate(http_server_requests_seconds_count{uri!~"/actuator.*"}[5m]))*1000 > 100
#         for: 2m
#         labels:
#           severity: warning
#         annotations:
#           summary: "High latency detected"
#           description: "Average latency {{ $value }} ms exceeds 100 ms for 2 minutes."
#       - alert: HighErrorRate
#         expr: rate(http_server_requests_seconds_count{status=~"5.."}[5m])/rate(http_server_requests_seconds_count[5m])*100 > 5
#         for: 2m
#         labels:
#           severity: warning
#         annotations:
#           summary: "High error rate detected"
#           description: "Error rate {{ $value }}% exceeds 5% for 2 minutes."
#       - alert: HighQueueLength
#         expr: sum(executor_queued_tasks{name="applicationTaskExecutor"}) > 50
#         for: 2m
#         labels:
#           severity: warning
#         annotations:
#           summary: "High queue length detected"
#           description: "Queue length {{ $value }} exceeds 50 for 2 minutes."
groups:
  - name: anomaly_alerts
    rules:
      - alert: HighLatency
        expr: avg(rate(http_server_requests_seconds_sum{uri=~"/api/.*"}[5m]) 
              / rate(http_server_requests_seconds_count{uri=~"/api/.*"}[5m])) * 1000 > 100
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High latency detected"
          description: "Average latency {{ $value }} ms exceeds 100 ms for 2 minutes."

      - alert: HighErrorRate
        expr: rate(http_server_requests_seconds_count{status=~"5..", uri=~"/api/.*"}[5m]) 
              / rate(http_server_requests_seconds_count{uri=~"/api/.*"}[5m]) * 100 > 5
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High error rate detected"
          description: "Error rate {{ $value }}% exceeds 5% for 2 minutes."

      - alert: HighQueueLength
        expr: sum(executor_queued_tasks{name="applicationTaskExecutor"}) > 50
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High queue length detected"
          description: "Queue length {{ $value }} exceeds 50 for 2 minutes."
